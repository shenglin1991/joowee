@if (conversation(); as conv) {
  <div class="chat-area">
    <!-- En-tête de conversation -->
    <div class="conversation-header">
      <div class="participant-info">
        @if (conv | otherParticipant; as participant) {
          <div class="participant-avatar" [class.offline-avatar]="!participant.isOnline">
            {{ participant.username | initial }}
          </div>
          <div class="participant-details">
            <div class="participant-name" [class.offline-name]="!participant.isOnline">
              {{ participant.username || 'Utilisateur inconnu' }}
            </div>
            <div class="participant-status" [class.offline-status]="!participant.isOnline">
              {{ participant.isOnline ? 'En ligne' : 'Hors ligne' }}
            </div>
          </div>
        } @else {
          <div class="participant-details">
            <div class="participant-name">Aucun participant</div>
            <div class="participant-status">Conversation invalide</div>
          </div>
        }
      </div>
    </div>

    <!-- Messages -->
    <div class="messages-container" #messagesContainer>
      @if (messages().length === 0) {
        <div class="no-messages">
          <p>Aucun message pour le moment</p>
          <p>Envoyez le premier message !</p>
        </div>
      }
      <div 
        *ngFor="let message of messages()" 
        class="message"
        [class.own-message]="isMessageFromCurrentUser(message)"
        [class.other-message]="!isMessageFromCurrentUser(message)"
      >
        <div class="message-content">
          {{ message.content }}
        </div>
        <div class="message-time">
          {{ formatTime(message.timestamp) }}
        </div>
      </div>
    </div>

    <!-- Zone de saisie -->
    <div class="message-input-area">
      <div class="input-container">
        <input 
          type="text" 
          [(ngModel)]="newMessageContent"
          (keyup.enter)="sendMessage()"
          placeholder="Tapez votre message..."
          class="message-input"
        />
        <button 
          class="send-btn" 
          (click)="sendMessage()"
          [disabled]="!newMessageContent.trim()"
        >
          Envoyer
        </button>
      </div>
    </div>
  </div>
} @else {
  <div class="no-conversation">
    <div class="empty-state">
      <h3>Aucune conversation sélectionnée</h3>
      <p>Sélectionnez une conversation existante ou démarrez un nouveau chat</p>
    </div>
  </div>
}
